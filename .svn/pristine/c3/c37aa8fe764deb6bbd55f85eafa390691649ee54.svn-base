var endpoint = 'http://ec2-54-64-173-140.ap-northeast-1.compute.amazonaws.com:8080/MosaicA/api';

// init
var imgId;
//alert("js読み込んだよ");
console.log("js読み込んだよ");

// 画像の選択
var dataUrl;
var selectButton = $('#selectButton')[0];
// 「ファイルを選択」の処理
if(selectButton){
	selectButton.addEventListener("change", function(evt){

		var file = evt.target.files;
		var fReader = new FileReader();
		fReader.readAsDataURL(file[0]);

		// 読み込み終了時
		fReader.onload = function(){

			dataUrl = fReader.result;
			$("#base64")[0].innerHTML = dataUrl;
			$("#selectedImg")[0].innerHTML = "<img src='" + dataUrl + "'>";
		};
	},false);
}


// 「送信」の処理
$('#send').click(function() {
	var img=$('#selectButton').val();
	var encodedUrl = encodeURIComponent(dataUrl);
	//console.log();

	// ファイルが選択されていることを確認(今のところ必ずしも画像が選択されているとは限らない)
	if(img.length < 1){
		alert("画像を選択してください");
		return;
	}

	if(window.confirm(img + 'を送信していいですか？')){
		// API呼び出し
		$.ajax({
			type: 'POST',
			url: endpoint + '/pushImage',
			data: {img: dataUrl},
			success: function(tmp){
				imgId = tmp;
				console.log(imgId);
				// 画面の遷移
				//location.href="viewimage.html"; // 今のところtmpに移動しているので注意
			}
		});
	}
});















// 表紙(?)のリサイズ
var wW,wH,aspectRatio;
var topImg;
topImg = $("#topImg")[0];
wW = window.innerWidth;
wH = window.innerHeight;
aspectRatio = topImg.height / topImg.width;
topImg.width = wW;
topImg.height = wW * aspectRatio;
$(window).resize(function() {
 	wW = window.innerWidth;
	topImg.width = wW;
	topImg.height = wW * aspectRatio;
});
